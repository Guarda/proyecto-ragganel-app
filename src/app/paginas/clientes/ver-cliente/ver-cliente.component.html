<div class="page-container">
    <mat-card class="card-cliente">
        <mat-card-header class="card-header">
            <div class="header-content">
                <mat-icon>account_circle</mat-icon>
                <mat-card-title>Detalles del Cliente #{{ clienteForm.get('IdCliente')?.value }}</mat-card-title>
            </div>
            <button mat-icon-button [routerLink]="['/home/listado-clientes']" class="close-button" matTooltip="Volver al listado">
                <mat-icon>close</mat-icon>
            </button>
        </mat-card-header>

        <mat-divider></mat-divider>

        <form [formGroup]="clienteForm" (ngSubmit)="onSubmit()">
            <mat-card-content class="card-content-container">
                <div class="profile-section">
                    <img [src]="ImagePath" alt="Imagen del Cliente" class="profile-image">
                    <h3 class="profile-name">{{ clienteForm.get('Nombre')?.value }}</h3>
                    
                    <div class="profile-info-item">
                        <mat-icon>email</mat-icon>
                        <span>{{ clienteForm.get('Correo')?.value }}</span>
                    </div>
                    <div class="profile-info-item">
                        <mat-icon>phone</mat-icon>
                        <span>{{ clienteForm.get('Telefono')?.value }}</span>
                    </div>
                </div>

                <div class="form-section">
    <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre Completo</mat-label>
        <input matInput formControlName="Nombre" required>
        <mat-error *ngIf="clienteForm.get('Nombre')?.hasError('required')">
          El nombre es obligatorio.
        </mat-error>
        <mat-error *ngIf="clienteForm.get('Nombre')?.hasError('maxLength')">
          El nombre no puede exceder los 255 caracteres.
        </mat-error>
    </mat-form-field>

    <div class="form-grid">
        <mat-form-field appearance="outline">
            <mat-label>Correo Electrónico</mat-label>
            <input matInput formControlName="Correo" type="email">
            <mat-error *ngIf="clienteForm.get('Correo')?.hasError('email')">
              Formato de correo no válido (ej: usuario&#64;dominio.com).
            </mat-error>
            <mat-error *ngIf="clienteForm.get('Correo')?.hasError('maxLength')">
              El correo no puede exceder los 255 caracteres.
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Teléfono</mat-label>
            <input matInput formControlName="Telefono" type="tel">
            <mat-error *ngIf="clienteForm.get('Telefono')?.hasError('minlength')">
              Debe tener al menos 8 números.
            </mat-error>
            <mat-error *ngIf="clienteForm.get('Telefono')?.hasError('maxLength')">
              El teléfono no puede exceder los 255 caracteres.
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>DNI</mat-label>
            <input matInput formControlName="DNI">
            <mat-error *ngIf="clienteForm.get('DNI')?.hasError('maxLength')">
              El DNI no puede exceder los 255 caracteres.
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>RUC</mat-label>
            <input matInput formControlName="RUC">
            <mat-error *ngIf="clienteForm.get('RUC')?.hasError('maxLength')">
              El RUC no puede exceder los 255 caracteres.
            </mat-error>
        </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="full-width">
        <mat-label>Dirección</mat-label>
        <input matInput formControlName="Direccion">
        <mat-error *ngIf="clienteForm.get('Direccion')?.hasError('maxLength')">
          La dirección no puede exceder los 255 caracteres.
        </mat-error>
    </mat-form-field>
    
    <mat-form-field appearance="outline" class="full-width">
        <mat-label>Comentarios</mat-label>
        <textarea matInput formControlName="Comentarios" rows="4" placeholder="Anotaciones internas sobre el cliente..."></textarea>
        <mat-error *ngIf="clienteForm.get('Comentarios')?.hasError('maxLength')">
          El comentario no puede exceder los 9999 caracteres.
        </mat-error>
    </mat-form-field>
</div>
            </mat-card-content>

            <mat-divider></mat-divider>

            <mat-card-actions class="card-actions">
                <button 
                    mat-stroked-button 
                    color="warn" 
                    (click)="openDialogEliminar(id)" 
                    matTooltip="Desactivar este cliente"
                    [disabled]="!clienteForm.get('Estado')?.value"> 
                    <mat-icon>delete</mat-icon>
                    Desactivar Cliente
                </button>
                <button mat-flat-button type="submit" color="primary" [disabled]="!clienteForm.dirty || !clienteForm.valid">
                    <mat-icon>save</mat-icon>
                    Guardar Cambios
                </button>
            </mat-card-actions>
        </form>
    </mat-card>

    <mat-card class="card-historial">
        <div class="historial-container">
            <app-listado-ventas-cliente [clienteId]="id"></app-listado-ventas-cliente>
        </div>
    </mat-card>
</div>