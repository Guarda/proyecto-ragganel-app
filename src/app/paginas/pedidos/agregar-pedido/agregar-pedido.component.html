<div class="contenedor-componente-crear-pedido">
    <h3 mat-dialog-title>
        <span>Agregar Pedido</span>
    </h3>
    <form [formGroup]="pedidoForm" (ngSubmit)="onSubmit()">
        <div class="contenedor-principal">
            <div class="contenedor-secundario">
                <div class="contenedor-row">
                    <div class="contenedor-img-consola">
                        <img [src]="ImagePath" alt="imagen-consola" class="imagen-consola">
                    </div>
                    <div class="contenedor-fechas">
                        <mat-label class="seccion-label">Fechas</mat-label>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Fecha Creación Pedido</mat-label>
                            <input matInput [matDatepicker]="creationDatePicker" formControlName="FechaCreacionPedido" required />
                            <mat-datepicker-toggle matSuffix [for]="creationDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #creationDatePicker></mat-datepicker>
                            <mat-error *ngIf="pedidoForm.get('FechaCreacionPedido')?.hasError('required')">
                                La fecha de creación es requerida.
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Fecha Arrivo USA</mat-label>
                            <input matInput [matDatepicker]="arrivoDatePicker" formControlName="FechaArrivoUSA" required />
                            <mat-datepicker-toggle matSuffix [for]="arrivoDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #arrivoDatePicker [matDatepickerFilter]="dateFilter"></mat-datepicker>
                             <mat-error *ngIf="pedidoForm.get('FechaArrivoUSA')?.hasError('required')">
                              Fecha Arrivo USA es requerida.
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="input-form-pedido">
                            <mat-label>Fecha Estimada Recepción</mat-label>
                            <input matInput [matDatepicker]="estimadaDatePicker" formControlName="FechaEstimadaRecepcion" required />
                            <mat-datepicker-toggle matSuffix [for]="estimadaDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #estimadaDatePicker [matDatepickerFilter]="dateFilter"></mat-datepicker>
                            <mat-error *ngIf="pedidoForm.get('FechaEstimadaRecepcion')?.hasError('required')">
                              Fecha Estimada es requerida.
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div class="contenedor-tracking">
                        <mat-label class="seccion-label">Tracking</mat-label>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Número Tracking 1</mat-label>
                            <input matInput type="text" formControlName="NumeroTracking1" required />
                            <mat-error *ngIf="pedidoForm.get('NumeroTracking1')?.hasError('maxLength')">
                              El tracking no puede exceder los 100 caracteres.
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Número Tracking 2</mat-label>
                            <input matInput type="text" formControlName="NumeroTracking2" />
                            <mat-error *ngIf="pedidoForm.get('NumeroTracking2')?.hasError('maxLength')">
                              El tracking no puede exceder los 100 caracteres.
                            </mat-error>
                        </mat-form-field>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Sitio Web</mat-label>
                            <mat-select formControlName="SitioWeb" required>
                                <mat-option *ngFor="let est of selectedSitioWebPedido" [value]="est.CodigoSitioWeb">{{est.DescripcionSitioWeb}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="contenedor-adicional">
                    <div class="contenedor-detalles">
                        <mat-label class="seccion-label">Detalles del pedido</mat-label>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Estado</mat-label>
                            <mat-select formControlName="Estado">
                                <mat-option *ngFor="let est of selectedEstadoPedido" [value]="est.CodigoEstadoPedido">
                                    {{ est.DescripcionEstadoPedido }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Peso del pedido (lbs)</mat-label>
                            <input matInput type="text" inputmode="decimal" formControlName="PesoPedido" (input)="enforceTwoDecimals($event)" />
                        </mat-form-field>
                        <mat-form-field class="input-form-pedido grow">
                            <mat-label>Comentarios</mat-label>
                            <textarea matInput class="comentario" formControlName="Comentarios" (input)="adjustTextareaHeight($event)" maxlength="9999"></textarea>
                            <mat-hint align="end">{{ pedidoForm.get('Comentarios')?.value?.length || 0 }}/9999</mat-hint>
                            <mat-error *ngIf="pedidoForm.get('Comentarios')?.hasError('maxLength')">
                              El comentario no puede exceder los 9999 caracteres.
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="contenedor-tarifas">
                        <mat-label class="seccion-label">Costos y Tarifas del Pedido</mat-label>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Vía Pedido</mat-label>
                            <mat-select formControlName="ViaPedido" required>
                                <mat-option *ngFor="let est of selectedTipoPedido" [value]="est.CodigoTipoPedido">{{est.DescripcionTipoPedido}}</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <mat-form-field class="input-form-pedido">
                            <mat-label>Subtotal de Artículos</mat-label>
                            <input matInput type="text" inputmode="decimal" formControlName="SubTotalArticulos" readonly />
                        </mat-form-field>

                        <mat-form-field class="input-form-pedido">
                            <mat-label>Impuestos</mat-label>
                            <input matInput type="text" inputmode="decimal" formControlName="Impuestos" (input)="enforceTwoDecimals($event)" />
                        </mat-form-field>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Envío a USA</mat-label>
                            <input matInput type="text" inputmode="decimal" formControlName="ShippingUSA" (input)="enforceTwoDecimals($event)" />
                        </mat-form-field>
                        <mat-form-field class="input-form-pedido">
                            <mat-label>Envío a NIC</mat-label>
                            <input matInput type="text" inputmode="decimal" formControlName="ShippingNic" (input)="enforceTwoDecimals($event)" />
                        </mat-form-field>
                        
                        <mat-form-field class="total-field">
                            <mat-label>TOTAL DEL PEDIDO</mat-label>
                            <input matInput formControlName="PrecioEstimadoDelPedido" readonly />
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>

        <div class="botones">
            <button mat-stroked-button type="button" (click)="onCancel()">Cancelar</button>
            <button mat-raised-button color="primary" type="submit" [disabled]="!pedidoForm.valid">Ingresar Pedido</button>
        </div>
    </form>
</div>

<app-index-listado-articulos></app-index-listado-articulos>