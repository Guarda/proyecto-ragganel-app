<h3 mat-dialog-title class="dialog-title">
  <span *ngIf="isEditMode; else agregarTitulo">Editar Artículo del Pedido</span>
  <ng-template #agregarTitulo>Agregar Artículo al Pedido</ng-template>
</h3>

<form [formGroup]="articulosForm" (ngSubmit)="onSubmit()">
  <mat-dialog-content class="dialog-content">
    <div class="main-container">

      <div class="form-column">

        <ng-container *ngIf="!isEditMode">
          <mat-form-field appearance="outline">
            <mat-label>Tipo Artículo</mat-label>
            <mat-select formControlName="TipoArticulo">
              <mat-option *ngFor="let est of selectedTipoArticulo" [value]="est.IdTipoArticuloPK">{{est.DescripcionTipoArticulo}}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Fabricante</mat-label>
            <mat-select formControlName="Fabricante">
              <mat-option *ngFor="let fabricante of selectedFabricante" [value]="fabricante.id">{{ fabricante.nombre }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Categoría</mat-label>
            <mat-select formControlName="Cate">
              <mat-option *ngFor="let categoria of selectedCategoria" [value]="categoria.id">{{ categoria.nombre }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Subcategoría</mat-label>
            <mat-select formControlName="SubCategoria">
              <mat-option *ngFor="let subCategoria of selectedSubCategoria" [value]="subCategoria.id">{{ subCategoria.nombre }}</mat-option>
            </mat-select>
          </mat-form-field>
        </ng-container>

        <ng-container *ngIf="isEditMode && articuloParaEditar">
          <div class="readonly-field">
            <label class="readonly-label">Tipo Artículo</label>
            <p class="readonly-value">{{ articuloParaEditar.NombreTipoArticulo }}</p>
          </div>
          <div class="readonly-field">
            <label class="readonly-label">Fabricante</label>
            <p class="readonly-value">{{ articuloParaEditar.NombreFabricante }}</p>
          </div>
          <div class="readonly-field">
            <label class="readonly-label">Categoría</label>
            <p class="readonly-value">{{ articuloParaEditar.NombreCategoria }}</p>
          </div>
          <div class="readonly-field">
            <label class="readonly-label">Subcategoría</label>
            <p class="readonly-value">{{ articuloParaEditar.NombreSubCategoria }}</p>
          </div>
        </ng-container>

        <mat-form-field appearance="outline">
          <mat-label>Enlace de Compra</mat-label>
          <textarea formControlName="EnlaceCompra" matInput rows="2"></textarea>
        </mat-form-field>
      </div>

      <div class="details-column">
        <div class="image-container">
          <img [src]="ImagePath" class="imagen-articulo" alt="Imagen del modelo seleccionado" />
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Cantidad</mat-label>
          <input matInput type="text" inputmode="decimal" formControlName="Cantidad" (input)="enforceTwoDecimals($event)" />
        </mat-form-field>

        <mat-button-toggle-group formControlName="priceMode" aria-label="Modo de Precio" class="price-toggle">
          <mat-button-toggle value="unit">Por Unidad</mat-button-toggle>
          <mat-button-toggle value="lot">Por Lote</mat-button-toggle>
        </mat-button-toggle-group>

        <mat-form-field appearance="outline" *ngIf="articulosForm.get('priceMode')?.value === 'unit'">
          <mat-label>Precio Unitario</mat-label>
          <input matInput type="text" inputmode="decimal" formControlName="Precio" (input)="enforceTwoDecimals($event)" />
          <span matTextPrefix>$&nbsp;</span>
        </mat-form-field>

        <mat-form-field appearance="outline" *ngIf="articulosForm.get('priceMode')?.value === 'lot'">
          <mat-label>Precio Total del Lote</mat-label>
          <input matInput type="text" inputmode="decimal" formControlName="PrecioLote" (input)="enforceTwoDecimals($event)" />
          <span matTextPrefix>$&nbsp;</span>
        </mat-form-field>

        <div class="calculated-price" *ngIf="articulosForm.get('priceMode')?.value === 'lot' && articulosForm.get('Precio')?.value > 0">
          <span>Precio unitario calculado: <strong>{{ articulosForm.get('Precio')?.value | currency:'USD' }}</strong></span>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-stroked-button mat-dialog-close>Cancelar</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="!articulosForm.valid">
      <span *ngIf="isEditMode; else agregarBoton">Guardar Cambios</span>
      <ng-template #agregarBoton>Agregar al Pedido</ng-template>
    </button>
  </mat-dialog-actions>
</form>