<mat-card [formGroup]="form">
  <mat-card-header class="compact-header">
    <mat-card-title>{{ articulo.NombreFabricante }} - {{ articulo.NombreSubCategoria }}</mat-card-title>
    <mat-card-subtitle>Artículo #{{ stepperIndex + 1 }}</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="card-layout-container">

    <div class="image-container">
      <img [src]="ImagePath" alt="Imagen de {{ articulo.NombreSubCategoria }}" class="articulo-imagen">
    </div>

    <div class="form-grid">

      <!-- <mat-form-field appearance="fill">
        <mat-label>Fabricante</mat-label>
        <mat-select formControlName="FabricanteAccesorio">
          <mat-option *ngFor="let fab of selectedFabricanteAccesorio" [value]="fab.IdFabricanteAccesorioPK">{{fab.NombreFabricanteAccesorio}}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Categoría</mat-label>
        <mat-select formControlName="CateAccesorio">
          <mat-option *ngFor="let cat of selectedCategoriaAccesorio" [value]="cat.IdCategoriaAccesorioPK">{{cat.NombreCategoriaAccesorio}}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Modelo</mat-label>
        <mat-select formControlName="SubCategoriaAccesorio">
          <mat-option *ngFor="let sub of selectedSubCategoriaAccesorio" [value]="sub.IdSubcategoriaAccesorio">{{sub.NombreSubcategoriaAccesorio}}</mat-option>
        </mat-select>
      </mat-form-field> -->

      <mat-form-field appearance="fill">
        <mat-label>Número de serie</mat-label>
        <input matInput formControlName="NumeroSerie">
        <mat-error *ngIf="form.get('NumeroSerie')?.hasError('maxlength')">
          Máximo 100 caracteres.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Color</mat-label>
        <input matInput formControlName="ColorAccesorio">
        <mat-error *ngIf="form.get('ColorAccesorio')?.hasError('maxlength')">
          Máximo 100 caracteres.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Estado</mat-label>
        <mat-select formControlName="EstadoAccesorio">
          <mat-option *ngFor="let est of selectedEstado" [value]="est.CodigoEstado">{{est.DescripcionEstado}}</mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('EstadoAccesorio')?.hasError('required')">
          El estado es requerido.
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="fill">
        <mat-label>Precio Base</mat-label>
        <input matInput type="number" formControlName="PrecioBase">
        <span matTextPrefix>$&nbsp;</span>
        <mat-error *ngIf="form.get('PrecioBase')?.hasError('required')">
          Requerido.
        </mat-error>
        <mat-error *ngIf="form.get('PrecioBase')?.hasError('pattern') || form.get('PrecioBase')?.hasError('max')">
          Precio inválido (Máx: 99999999.99).
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="costo-distribuido-field">
        <mat-label>Costo Adicional</mat-label>
        <input matInput type="number" formControlName="CostoDistribuido">
        <span matTextPrefix>$&nbsp;</span>
        <mat-error *ngIf="form.get('CostoDistribuido')?.hasError('pattern') || form.get('CostoDistribuido')?.hasError('max')">
          Costo inválido (Máx: 99999999.99).
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full-width-field">
        <mat-label>Productos Compatibles</mat-label>
        <mat-chip-grid #chipGrid aria-label="Productos compatibles">
          @for (keyword of keywords(); track keyword) {
            <mat-chip-row (removed)="removeCompatibleProduct(keyword)">
              {{keyword}}
              <button matChipRemove [attr.aria-label]="'quitar ' + keyword">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          }
        </mat-chip-grid>
        <input placeholder="Agrega productos..." [matChipInputFor]="chipGrid" (matChipInputTokenEnd)="addCompatibleProduct($event)"/>
        <mat-error *ngIf="form.get('ProductosCompatibles')?.hasError('totalLengthExceeded')">
          Lista muy larga (Máx: 500 caracteres).
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="fill" class="full-width-field">
        <mat-label>Tareas a realizar (Checklist)</mat-label>
        <mat-chip-grid #reactiveChipGrid aria-label="Tareas a realizar">
          @for (keyword of todolistKeywords(); track keyword) {
            <mat-chip-row (removed)="removeTodo(keyword)">
              {{keyword}}
              <button matChipRemove [attr.aria-label]="'quitar ' + keyword">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          }
        </mat-chip-grid>
        <input placeholder="Agrega tareas..." [matChipInputFor]="reactiveChipGrid" (matChipInputTokenEnd)="addTodo($event)"/>
        <mat-error *ngIf="form.get('TodoList')?.hasError('totalLengthExceeded')">
          Lista muy larga (Máx: 1000 caracteres).
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="fill" class="full-width-field">
        <mat-label>Comentarios</mat-label>
        <textarea matInput formControlName="ComentarioAccesorio" placeholder="Caja dañada, sin manual, etc..." cdkTextareaAutosize cdkAutosizeMinRows="1"></textarea>
        <mat-error *ngIf="form.get('ComentarioAccesorio')?.hasError('maxlength')">
          Comentario muy largo (Máx: 10,000 caracteres).
        </mat-error>
      </mat-form-field>

    </div>
  </mat-card-content>

  <mat-card-actions class="card-footer">
    <h4>
      Precio Final de Ingreso:
      <strong>{{ precioFinalIngreso | currency }}</strong>
    </h4>
  </mat-card-actions>
</mat-card>